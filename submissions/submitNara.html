<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Submit a Nara Design</title>
  <link rel="stylesheet" href="style.css">
</head>
<body class="page">
  <h1>Submit a New Nara</h1>

  <form id="naraForm">
    <label>Nara Name/ID:
      <input type="text" name="Nara" required>
    </label>
    <label>Type:
      <input type="text" name="Type" required>
    </label>
    <label>Owner:
      <input type="text" name="Owner" required>
    </label>
    <label>Designer:
      <input type="text" name="Designer" required>
    </label>
    <label>Artist:
      <input type="text" name="Artist" required>
    </label>
    <label>Build:
      <input type="text" name="Build">
    </label>
    <label>Ribbons:
      <input type="text" name="Ribbons">
    </label>
    <label>Vessel:
      <input type="text" name="Vessel">
    </label>

    <label>Upload Image:
      <input type="file" id="imageFile" accept="image/*" required>
    </label>

    <button type="submit">Submit</button>
  </form>

  <p id="statusMsg"></p>

  <script>
    const IMGUR_CLIENT_ID = "YOUR_IMGUR_CLIENT_ID";  // get from Imgur
    const SCRIPT_URL = "YOUR_DEPLOYED_APPS_SCRIPT_URL"; // web app endpoint

    document.getElementById("naraForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const statusMsg = document.getElementById("statusMsg");
      statusMsg.textContent = "Uploading image...";

      // 1. Upload image to Imgur
      const file = document.getElementById("imageFile").files[0];
      if (!file) return alert("Please select an image");

      const formData = new FormData();
      formData.append("image", file);

      const imgurRes = await fetch("https://api.imgur.com/3/image", {
        method: "POST",
        headers: { Authorization: "Client-ID " + IMGUR_CLIENT_ID },
        body: formData
      });
      const imgurData = await imgurRes.json();

      if (!imgurData.success) {
        statusMsg.textContent = "❌ Failed to upload image.";
        return;
      }

      const imageUrl = imgurData.data.link;
      statusMsg.textContent = "Image uploaded. Submitting Nara...";

      // 2. Collect form data
      const form = e.target;
      const payload = {
        type: "submitNara",
        Timestamp: new Date().toISOString(),
        Comments: "",
        Nara: form.Nara.value,
        Hide: "FALSE",
        URL: imageUrl,
        Art: "Pending",
        Type: form.Type.value,
        Owner: form.Owner.value,
        "Discord ID": "",   // can be auto-filled from login session later
        Designer: form.Designer.value,
        Artist: form.Artist.value,
        Status: "Pending",
        Rarity: "",
        Region: "",
        Calling: "",
        Value: "",
        Build: form.Build.value,
        Inventory: "",
        Palcharms: "",
        Emblems: "",
        Titles: "",
        Guild: "",
        Vessel: form.Vessel.value,
        Ribbons: form.Ribbons.value,
        Tail: "",
        Physiognomy: "",
        Aesthetics: "",
        "Narling Form": "",
        Mernara: "",
        Humanara: "",
        Transformation: "",
        "Alt form": ""
      };

      // 3. Send to Apps Script
      const res = await fetch(SCRIPT_URL, {
        method: "POST",
        body: new URLSearchParams(payload)
      });
      const result = await res.json();

      if (result.success) {
        statusMsg.textContent = "✅ Nara submitted successfully!";
        form.reset();
      } else {
        statusMsg.textContent = "❌ Error: " + result.error;
      }
    });
  </script>
</body>
</html>
