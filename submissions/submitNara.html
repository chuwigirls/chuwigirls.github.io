<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Submit a Nara Design</title>
  <link rel="stylesheet" href="/styles/narasnature.css">
</head>
<body>
  <div class="wrapper">
    <div class="page">
      <h1>Submit a New Nara</h1>

      <form id="naraForm">
        <label>Nara Name/ID:
          <input type="text" name="Nara" required>
        </label>
        <label>Type:
          <input type="text" name="Type" required>
        </label>
        <label>Owner:
          <input type="text" name="Owner" required>
        </label>
        <label>Designer:
          <input type="text" name="Designer" required>
        </label>
        <label>Artist:
          <input type="text" name="Artist" required>
        </label>
        <label>Build:
          <input type="text" name="Build">
        </label>
        <label>Ribbons:
          <input type="text" name="Ribbons">
        </label>
        <label>Vessel:
          <input type="text" name="Vessel">
        </label>

        <label>Upload Image:
          <input type="file" id="imageFile" accept="image/*">
        </label>

        <button type="submit">Submit</button>
      </form>

      <p id="statusMsg"></p>
    </div>
  </div>
  

  <script>
    const IMGUR_CLIENT_ID = "YOUR_IMGUR_CLIENT_ID";  // for later
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyYg8RUmOYKgbBuz8mtFqq_KM6JUcW_uTzt83gITg2-qLZRaWoaFFFo0OtZQOD9mGOY/exec";

    document.getElementById("naraForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      const statusMsg = document.getElementById("statusMsg");
      statusMsg.textContent = "Preparing submission...";

      // ===== TEMP: skip Imgur upload =====
      const imageUrl = "https://via.placeholder.com/300"; // üëà placeholder URL
      // ================================

      // 2. Collect form data
      const form = e.target;

      // generate both ISO string and epoch
      const now = new Date();
      const timestampISO = now.toISOString();
      const timestampEpoch = now.getTime().toString();

      const payload = {
        type: "submitNara",
        Timestamp: timestampISO,      // human-readable
        TimestampEpoch: timestampEpoch, // ‚úÖ for reliable matching later
        Comments: "",
        Nara: form.Nara.value,
        Hide: "FALSE",
        URL: imageUrl,
        Art: "Pending",
        Type: form.Type.value,
        Owner: form.Owner.value,
        "Discord ID": "",   // can be filled later from session
        Designer: form.Designer.value,
        Artist: form.Artist.value,
        Status: "Pending",
        Rarity: "",
        Region: "",
        Calling: "",
        Value: "",
        Build: form.Build.value,
        Inventory: "",
        Palcharms: "",
        Emblems: "",
        Titles: "",
        Guild: "",
        Vessel: form.Vessel.value,
        Ribbons: form.Ribbons.value,
        Tail: "",
        Physiognomy: "",
        Aesthetics: "",
        "Narling Form": "",
        Mernara: "",
        Humanara: "",
        Transformation: "",
        "Alt form": ""
      };

      // 3. Send to Apps Script
      try {
        const res = await fetch(SCRIPT_URL, {
          method: "POST",
          body: new URLSearchParams(payload)
        });
        const result = await res.json();

        if (result.success) {
          statusMsg.textContent = "‚úÖ Nara submitted successfully!";
          form.reset();
        } else {
          statusMsg.textContent = "‚ùå Error: " + result.error;
        }
      } catch (err) {
        console.error(err);
        statusMsg.textContent = "‚ùå Submission failed: " + err.message;
      }
    });
  </script>
</body>
</html>
